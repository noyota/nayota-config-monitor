module.exports=function(t){var r={};function e(s){if(r[s])return r[s].exports;var o=r[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=r,e.d=function(t,r,s){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)e.d(s,o,function(r){return t[r]}.bind(null,o));return s},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=0)}([function(module,exports){function Relay(t,r){this.addrmin=1,this.addrmax=255,this.validate=r,this.button=[0,1,2,3],this.options=t;var e=this;e.checksAddress=[],t.defaultCheck.forEach(function(t){e["analysis"+t.address]=t.analysis,e.checksAddress.push(t.address)}),t.defaultOperate.forEach(function(t){e["analysis"+t.address]=t.analysis})}var rmDb=function(t){return t};Relay.prototype.find=function(t,r){t&&"string"==typeof t&&(t=parseInt(t)),r&&"string"==typeof r&&(r=parseInt(r));for(var e=t||this.addrmin,s=r||this.addrmax,o="";e<=s;){for(var n=e.toString(16);n.length<2;)n="0"+n;o+=this.validate.crc16(n+"0400100002")+",",e++}var a=this.validate,d=this.options.name,i=this.options.defaultCheck,c=this.options.defaultOperate,l=[];return void 0!==this.options.attribute&&(l=this.options.attribute),{cmd:o.substr(0,o.length-1),resolve:function(t,r,e){if(t.length<18)return e(400);var s=t.substr(0,t.length-4);if(a.crc16(s).toLowerCase()!==t.toLowerCase())return e(401);if("04"!==t.substr(2,2))return e(402);var o=t.substr(0,2),n={shortAddress:o,name:d+o,checks:i,operates:c,attribute:l};return console.log(n),r(n)},changeAddr:!0}},Relay.prototype.changeAddr=function(t){for("number"==typeof t.shortAddress&&(t.shortAddress=t.shortAddress.toString(16));t.shortAddress.length<2;)t.shortAddress="0"+t.shortAddress;for("number"==typeof t.oldAddr&&(t.oldAddr=t.oldAddr.toString(16));t.oldAddr.length<2;)t.oldAddr="0"+t.oldAddr;var r=t.oldAddr+"06015600"+t.shortAddress;r=this.validate.crc16(r);var e=this.validate,s=this.options.name,o=this.options.defaultOperate,n=this.options.defaultCheck,a=[];return void 0!==this.options.attribute&&(a=this.options.attribute),{cmd:r,resolve:function(r,d,i){if(r.length<16)return i(400);var c=r.substr(0,r.length-4);return e.crc16(c).toUpperCase()!==r.toUpperCase()?i(401):"06"!==r.substr(2,2)?i(402):d({shortAddress:t.shortAddress,name:s+t.shortAddress,checks:n,operates:o,attribute:a})}}},Relay.prototype.read=function(addr,code){null==code?code=this.checksAddress:"string"==typeof code&&(code=[code]);for(var analysis=[],_this=this;addr.length<2;)addr="0"+addr;var commond1=this.validate.crc16(addr+"04 00 10 00 02"),commond2=this.validate.crc16(addr+"04 00 12 00 01"),commond3=this.validate.crc16(addr+"04 00 13 00 02"),commond4=this.validate.crc16(addr+"04 00 15 00 01"),commond5=this.validate.crc16(addr+"04 00 1D 00 01"),commond6=this.validate.crc16(addr+"04 00 16 00 02"),commond7=this.validate.crc16(addr+"04 00 18 00 02"),cmd=[],allOperates=["1"];allOperates.forEach(function(t){code.push(t)}),code.forEach(function(t){"10"===t&&cmd.push(commond1),"12"===t&&cmd.push(commond2),"13"===t&&cmd.push(commond3),"15"===t&&cmd.push(commond4),"1"===t&&cmd.push(commond5),"16"===t&&cmd.push(commond6),"18"===t&&cmd.push(commond7),analysis.push(_this["analysis"+t])});var validate=this.validate;return{cmd:cmd.join(","),resolve:function(result,success,error){var data=result.split(",");if(data.length!==cmd.length)return error(400);for(var res={},allChecks={},i=0;i<data.length;i++){var item=rmDb(data[i]),validatedata=validate.crc16(item.substr(0,item.length-4));if(validatedata.toLowerCase()!==item.toLowerCase())return error(401);var addrback=item.substr(0,2);if(addrback!==addr.toLowerCase())return error(403);if(cmd[i]===commond1){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[10]=item.substr(6,8)}else if(cmd[i]===commond2){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[12]=item.substr(6,4)}else if(cmd[i]===commond3){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[13]=item.substr(6,8)}else if(cmd[i]===commond4){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[15]=item.substr(6,4)}else if(cmd[i]===commond5){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[1]=item.substr(6,4)}else if(cmd[i]===commond6){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[16]=item.substr(6,8)}else if(cmd[i]===commond7){const t=item.substr(2,2);if("04"!==t)return error(402);allChecks[18]=item.substr(6,8)}}code.forEach(function(item,index){var analyze=null;eval(analysis[index]),allChecks[item]&&analyze&&(res[item]=analyze(allChecks[item]))}),console.log(res),success(res)}}},Relay.prototype.write=function(t,r,e){for("number"==typeof t&&(t=t.toString(16));t.length<2;)t="0"+t;e=parseInt(e),console.log(e),1===e?e="01":0===e&&(e="04");var s=this.validate,o=[this.validate.crc16(t+"0601D000"+e)];return{cmd:o.join(","),resolve:function(r,e,n){var a=r.split(",");if(a.length!==o.length)return n(400);for(var d=0;d<a.length;d++){var i=a[d];if(i=i.substr(0,i.length-4),s.crc16(i).toLowerCase()!==a[d].toLowerCase())return n(401);if(i.substr(0,2).toLowerCase()!==t.toLowerCase())return n(403)}if("06"!==i.substr(2,2))return n(402);let c=i.substr(10,2);return"04"===c?c=0:"01"===c&&(c=1),e(c)}}},Relay.prototype.navi=function(t){if(t){return t.substr(0,2)}return null},module.exports=Relay}]);